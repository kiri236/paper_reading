{"layout":"logicalStructure","root":{"data":{"text":"<p>HiRED</p>","expand":true,"uid":"cc04918b-df59-4892-8bc0-f57077b086ed","richText":true,"isActive":false,"imgMap":{}},"children":[{"data":{"text":"<p>先前研究的不足</p>","uid":"e50ad995-c969-45a6-9900-deff5ff17ea1","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>先前的方法不能同时支持高分辨率,low token budget , early dropping,wide task Coverage</p>","uid":"ee95fcfc-0c3c-4337-b8d3-4d66dfdc00aa","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>FastV,PruMerge只支持低分辨率图象</p>","uid":"9e99bcef-0f34-4808-89ae-545299ea7e33","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>FlexAttention虽能处理高分辨 率图像，却无法根据资源限制动态控制视觉标记数量</p>","expand":true,"richText":true,"isActive":false,"uid":"9589722d-2ebe-4865-895a-56da4e0ea57e"},"children":[]},{"data":{"text":"<p>TokenCorr Compressor只能用于文本理解任务</p>","expand":true,"richText":true,"isActive":false,"uid":"878948b0-581f-4132-9be0-ea4272e58840"},"children":[]}]}]},{"data":{"text":"<p>观察</p>","expand":true,"richText":true,"isActive":false,"uid":"0d01fd75-80ea-4d70-b241-fd5364d4f671"},"children":[{"data":{"text":"<p>视觉token输入很多但分配在上面的attention很少</p>","uid":"51399ff3-4d66-4c09-bfbb-4275d840c464","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>少数的visual token占了大部分的attention</p>","expand":true,"richText":true,"isActive":false,"uid":"7ad36ac5-397d-4ecf-a3cd-0348768321be"},"children":[]},{"data":{"text":"<p>图象中某些区域token冗余量比其他区域多</p>","expand":true,"richText":true,"isActive":false,"uid":"ffc8ffa8-f8ee-43e9-97dd-552dfa7adb8e"},"children":[]}]},{"data":{"text":"<p>ViT中的CLS的attention</p>","expand":true,"richText":true,"isActive":false,"uid":"52ecefc5-26ba-4be5-b102-e0ba5d9a236a"},"children":[{"data":{"text":"<p>CLIP将输入图像分割为不重叠的patch</p>","uid":"05555c6c-deb6-436f-9ed6-6af2427fb388","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>Transformer中CLS令牌用于从patch token中提取有用信息,其CLS的注意力反应了patch的重要性</p>","uid":"2a345cb1-e042-47e6-a72a-10450d055c0f","expand":true,"richText":true,"isActive":false},"children":[]}]},{"data":{"text":"<p>CLS在浅层会将局部特征编码为对应的图像块,在深层会学习这些局部特征之间的关系,会将他们编码为少数背景块作为全局特征</p>","expand":true,"richText":true,"isActive":false,"uid":"37c2140d-d81b-4c96-b387-5a62fe2ab1d3"},"children":[{"data":{"text":"<p>所以最后一层CLS attention突出的区域会优先选择信息量高于其他区域的图像块</p>","uid":"c5d3574a-9c99-44ba-af80-b716765d2c19","expand":true,"richText":true,"isActive":false},"children":[]}]}]},{"data":{"text":"<p>HiRED</p>","expand":true,"richText":true,"isActive":false,"uid":"e8ca4e84-f892-460f-81e0-e4f487d69d75"},"children":[{"data":{"text":"<p>Token Budget Allocation</p>","uid":"851ed826-5704-4d64-9bb7-9b5afeaba09c","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>设<span class=\"ql-formula\" data-value=\"{p_0,\\cdots p_k}\">﻿<span contenteditable=\"false\"><span class=\"katex\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>p</mi><mn>0</mn></msub><mo separator=\"true\">,</mo><mo>⋯</mo><msub><mi>p</mi><mi>k</mi></msub></mrow><annotation encoding=\"application/x-tex\">{p_0,\\cdots p_k}</annotation></semantics></math></span></span>﻿</span>表示k+1个图像分区的集合,<span class=\"ql-formula\" data-value=\"p_0\">﻿<span contenteditable=\"false\"><span class=\"katex\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>p</mi><mn>0</mn></msub></mrow><annotation encoding=\"application/x-tex\">p_0</annotation></semantics></math></span></span>﻿</span>为full image,其余<span class=\"ql-formula\" data-value=\"p_i\">﻿<span contenteditable=\"false\"><span class=\"katex\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>p</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">p_i</annotation></semantics></math></span></span>﻿</span>为sub image</p>","uid":"7a0cae75-f4fc-493e-b613-b577aac5343c","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>记<span class=\"ql-formula\" data-value=\"T_{p_i}\">﻿<span contenteditable=\"false\"><span class=\"katex\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>T</mi><msub><mi>p</mi><mi>i</mi></msub></msub></mrow><annotation encoding=\"application/x-tex\">T_{p_i}</annotation></semantics></math></span></span>﻿</span>为<span class=\"ql-formula\" data-value=\"p_i\">﻿<span contenteditable=\"false\"><span class=\"katex\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>p</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">p_i</annotation></semantics></math></span></span>﻿</span>中的token index的集合,每个分区共有<span class=\"ql-formula\" data-value=\"N_{ViT}\">﻿<span contenteditable=\"false\"><span class=\"katex\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>N</mi><mrow><mi>V</mi><mi>i</mi><mi>T</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">N_{ViT}</annotation></semantics></math></span></span>﻿</span>个token,在丢弃前共有<span class=\"ql-formula\" data-value=\"N_{ViT}\\times (k+1)\">﻿<span contenteditable=\"false\"><span class=\"katex\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>N</mi><mrow><mi>V</mi><mi>i</mi><mi>T</mi></mrow></msub><mo>×</mo><mo stretchy=\"false\">(</mo><mi>k</mi><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">N_{ViT}\\times (k+1)</annotation></semantics></math></span></span>﻿</span>个token,设总共预算为<span class=\"ql-formula\" data-value=\"N_{budget}\">﻿<span contenteditable=\"false\"><span class=\"katex\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>N</mi><mrow><mi>b</mi><mi>u</mi><mi>d</mi><mi>g</mi><mi>e</mi><mi>t</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">N_{budget}</annotation></semantics></math></span></span>﻿</span>将其分配到k+1个分区中,每个分区的预算为<span class=\"ql-formula\" data-value=\"N_{p_i}\">﻿<span contenteditable=\"false\"><span class=\"katex\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>N</mi><msub><mi>p</mi><mi>i</mi></msub></msub></mrow><annotation encoding=\"application/x-tex\">N_{p_i}</annotation></semantics></math></span></span>﻿</span></p>","uid":"21af083c-d919-429e-9214-6b52c1750217","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>考虑用H个头和L层的ViT,用<span class=\"ql-formula\" data-value=\"a_{l,h}^{p_i}[j]\">﻿<span contenteditable=\"false\"><span class=\"katex\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msubsup><mi>a</mi><mrow><mi>l</mi><mo separator=\"true\">,</mo><mi>h</mi></mrow><msub><mi>p</mi><mi>i</mi></msub></msubsup><mo stretchy=\"false\">[</mo><mi>j</mi><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">a_{l,h}^{p_i}[j]</annotation></semantics></math></span></span>﻿</span>(<span class=\"ql-formula\" data-value=\"j=1,2,\\cdots T_{p_i}\">﻿<span contenteditable=\"false\"><span class=\"katex\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>j</mi><mo>=</mo><mn>1</mn><mo separator=\"true\">,</mo><mn>2</mn><mo separator=\"true\">,</mo><mo>⋯</mo><msub><mi>T</mi><msub><mi>p</mi><mi>i</mi></msub></msub></mrow><annotation encoding=\"application/x-tex\">j=1,2,\\cdots T_{p_i}</annotation></semantics></math></span></span>﻿</span>)表示分区<span class=\"ql-formula\" data-value=\"p_i\">﻿<span contenteditable=\"false\"><span class=\"katex\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>p</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">p_i</annotation></semantics></math></span></span>﻿</span>在第l层的第h个头上CLS的attention score</p>","uid":"3ea458a9-e1b2-40c6-972e-896c0c2a4bf9","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>首先用allocation ration<span class=\"ql-formula\" data-value=\"\\alpha\\in [0,1]\">﻿<span contenteditable=\"false\"><span class=\"katex\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>α</mi><mo>∈</mo><mo stretchy=\"false\">[</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>1</mn><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">\\alpha\\in [0,1]</annotation></semantics></math></span></span>﻿</span>确定full image<span class=\"ql-formula\" data-value=\"p_0\">﻿<span contenteditable=\"false\"><span class=\"katex\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>p</mi><mn>0</mn></msub></mrow><annotation encoding=\"application/x-tex\">p_0</annotation></semantics></math></span></span>﻿</span>分配的预算<span class=\"ql-formula\" data-value=\"N_{p_0}=\\lfloor \\alpha N \\rfloor\">﻿<span contenteditable=\"false\"><span class=\"katex\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>N</mi><msub><mi>p</mi><mn>0</mn></msub></msub><mo>=</mo><mo stretchy=\"false\">⌊</mo><mi>α</mi><mi>N</mi><mo stretchy=\"false\">⌋</mo></mrow><annotation encoding=\"application/x-tex\">N_{p_0}=\\lfloor \\alpha N \\rfloor</annotation></semantics></math></span></span>﻿</span></p>","uid":"eead9e34-9b6f-440c-b570-4570acef0f54","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>再将剩余的预算<span class=\"ql-formula\" data-value=\"N_{sub}\">﻿<span contenteditable=\"false\"><span class=\"katex\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>N</mi><mrow><mi>s</mi><mi>u</mi><mi>b</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">N_{sub}</annotation></semantics></math></span></span>﻿</span>分配到k个子图像上</p>","expand":true,"richText":true,"isActive":false,"uid":"f2de2426-5eac-40b9-8c53-c4312fdf1a8a"},"children":[{"data":{"text":"<p>因为浅层CLS的attention捕捉图像中的视觉分布,所以attention score高的地方就要更多的预算</p>","uid":"de4d75f4-8742-4267-bc6a-8cd4343e1a29","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>为此计算一个visual content score:<span class=\"ql-formula\" data-value=\"s_{p_i}=\\sum_{j\\in T_{p_i}}\\sum_h^H a^{p_o}_{l_{init},h}\">﻿<span contenteditable=\"false\"><span class=\"katex\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>s</mi><msub><mi>p</mi><mi>i</mi></msub></msub><mo>=</mo><msub><mo>∑</mo><mrow><mi>j</mi><mo>∈</mo><msub><mi>T</mi><msub><mi>p</mi><mi>i</mi></msub></msub></mrow></msub><msubsup><mo>∑</mo><mi>h</mi><mi>H</mi></msubsup><msubsup><mi>a</mi><mrow><msub><mi>l</mi><mrow><mi>i</mi><mi>n</mi><mi>i</mi><mi>t</mi></mrow></msub><mo separator=\"true\">,</mo><mi>h</mi></mrow><msub><mi>p</mi><mi>o</mi></msub></msubsup></mrow><annotation encoding=\"application/x-tex\">s_{p_i}=\\sum_{j\\in T_{p_i}}\\sum_h^H a^{p_o}_{l_{init},h}</annotation></semantics></math></span></span>﻿</span>[j]</p>","uid":"15766fc0-5aaf-4729-bee8-47a0265eea33","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>每个子图像上的预算为<span class=\"ql-formula\" data-value=\"N_{p_i}=\\lfloor N_{sub}\\frac{s_{p_i}}{\\sum_{j=1}^{k}s_{p_j}}\\rfloor\">﻿<span contenteditable=\"false\"><span class=\"katex\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>N</mi><msub><mi>p</mi><mi>i</mi></msub></msub><mo>=</mo><mo stretchy=\"false\">⌊</mo><msub><mi>N</mi><mrow><mi>s</mi><mi>u</mi><mi>b</mi></mrow></msub><mfrac><msub><mi>s</mi><msub><mi>p</mi><mi>i</mi></msub></msub><mrow><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>k</mi></msubsup><msub><mi>s</mi><msub><mi>p</mi><mi>j</mi></msub></msub></mrow></mfrac><mo stretchy=\"false\">⌋</mo></mrow><annotation encoding=\"application/x-tex\">N_{p_i}=\\lfloor N_{sub}\\frac{s_{p_i}}{\\sum_{j=1}^{k}s_{p_j}}\\rfloor</annotation></semantics></math></span></span>﻿</span></p>","uid":"db54f8d3-d64c-46ed-a6fa-07002962b46b","expand":true,"richText":true,"isActive":false},"children":[]}]}]}]}]}]}]}]},{"data":{"text":"<p>Visual Token Dropping</p>","expand":true,"richText":true,"isActive":false,"uid":"4df5dd56-b34f-467c-b977-2c1662514523"},"children":[{"data":{"text":"<p>为每个分区算一个feature importance score:<span class=\"ql-formula\" data-value=\"f^{p_i}[j],(j=1,2\\cdots N_{ViT})\">﻿<span contenteditable=\"false\"><span class=\"katex\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>f</mi><msub><mi>p</mi><mi>i</mi></msub></msup><mo stretchy=\"false\">[</mo><mi>j</mi><mo stretchy=\"false\">]</mo><mo separator=\"true\">,</mo><mo stretchy=\"false\">(</mo><mi>j</mi><mo>=</mo><mn>1</mn><mo separator=\"true\">,</mo><mn>2</mn><mo>⋯</mo><msub><mi>N</mi><mrow><mi>V</mi><mi>i</mi><mi>T</mi></mrow></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">f^{p_i}[j],(j=1,2\\cdots N_{ViT})</annotation></semantics></math></span></span>﻿</span></p>","uid":"47e88ef2-9247-4a6e-86c7-3cd6af04eea9","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>最终层的CLS attention会着重于图像分区主体和背景中信息丰富的分区,且不同attention head会学到不同的特征</p>","uid":"8f5ed2b9-7b28-4a99-a91a-f15288824607","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>所以<span class=\"ql-formula\" data-value=\"p_i\">﻿<span contenteditable=\"false\"><span class=\"katex\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>p</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">p_i</annotation></semantics></math></span></span>﻿</span>分区中第<span class=\"ql-formula\" data-value=\"j\">﻿<span contenteditable=\"false\"><span class=\"katex\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>j</mi></mrow><annotation encoding=\"application/x-tex\">j</annotation></semantics></math></span></span>﻿</span>个token的<span class=\"ql-formula\" data-value=\"f^{p_i}[j]=\\sum_{h=1}^H a_{l_{final},h}^{p_i}[j]\">﻿<span contenteditable=\"false\"><span class=\"katex\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>f</mi><msub><mi>p</mi><mi>i</mi></msub></msup><mo stretchy=\"false\">[</mo><mi>j</mi><mo stretchy=\"false\">]</mo><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>h</mi><mo>=</mo><mn>1</mn></mrow><mi>H</mi></msubsup><msubsup><mi>a</mi><mrow><msub><mi>l</mi><mrow><mi>f</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>l</mi></mrow></msub><mo separator=\"true\">,</mo><mi>h</mi></mrow><msub><mi>p</mi><mi>i</mi></msub></msubsup><mo stretchy=\"false\">[</mo><mi>j</mi><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">f^{p_i}[j]=\\sum_{h=1}^H a_{l_{final},h}^{p_i}[j]</annotation></semantics></math></span></span>﻿</span></p>","uid":"712b94af-e7ae-4d9b-b56d-be1ef0659164","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>最后每个分区<span class=\"ql-formula\" data-value=\"p_i\">﻿<span contenteditable=\"false\"><span class=\"katex\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>p</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">p_i</annotation></semantics></math></span></span>﻿</span>保留<span class=\"ql-formula\" data-value=\"f^{p_i}[j]\">﻿<span contenteditable=\"false\"><span class=\"katex\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>f</mi><msub><mi>p</mi><mi>i</mi></msub></msup><mo stretchy=\"false\">[</mo><mi>j</mi><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">f^{p_i}[j]</annotation></semantics></math></span></span>﻿</span>最高的<span class=\"ql-formula\" data-value=\"N_{p_i}\">﻿<span contenteditable=\"false\"><span class=\"katex\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>N</mi><msub><mi>p</mi><mi>i</mi></msub></msub></mrow><annotation encoding=\"application/x-tex\">N_{p_i}</annotation></semantics></math></span></span>﻿</span>个视觉token,将其与其他token拼接送入LLM中</p>","uid":"09d81650-d5b6-4855-bfcb-0d78be5e6369","expand":true,"richText":true,"isActive":false},"children":[]}]}]}]}]}]},{"data":{"text":"<p>性能</p>","expand":true,"richText":true,"isActive":false,"uid":"90afb18b-b87d-4f62-9e8f-daba008b53fe"},"children":[{"data":{"text":"<p>在LLaVa-7B和13B上分别进行实验</p>","uid":"af892df0-0ca1-41d6-951d-5753921f220f","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>只用40%token的HiRED准确率相较于使用了55%token的PruMerge+在Transcription任务上性能更优</p>","uid":"fc9ae1b6-5e90-4c57-9b51-8018026c7e6b","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>相较于baseline剪掉大多数token的情况下只牺牲少许性能</p>","expand":true,"richText":true,"isActive":false,"uid":"91839d98-8bc4-466a-99d0-3d1d5ddc08ed"},"children":[]},{"data":{"text":"<p>在推理中实现了4.7X的token吞吐量</p>","expand":true,"richText":true,"isActive":false,"uid":"4fb669bc-1aca-44db-b3ce-42ee83590de4"},"children":[]},{"data":{"text":"<p>降低了78%的TTFT延迟</p>","expand":true,"richText":true,"isActive":false,"uid":"4bc25f7e-be17-4fbb-9c0a-579c45df5dc9"},"children":[]},{"data":{"text":"<p>减少了14%的GPU限制</p>","expand":true,"richText":true,"isActive":false,"uid":"75141d23-bc34-4055-8c44-dea228133929"},"children":[]}]}]}],"smmVersion":"0.14.0-fix.1"},"theme":{"template":"classic4","config":{}},"view":{"transform":{"scaleX":1,"scaleY":1,"shear":0,"rotate":0,"translateX":-680,"translateY":-504,"originX":0,"originY":0,"a":1,"b":0,"c":0,"d":1,"e":-680,"f":-504},"state":{"scale":1,"x":-680,"y":-504,"sx":-357.5,"sy":-364.5}}}